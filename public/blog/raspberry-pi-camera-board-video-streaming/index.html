<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My New Hugo Site  | Raspberry Pi camera board video streaming</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.52" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Raspberry Pi camera board video streaming" />
<meta property="og:description" content="Set up a video streaming server using the Raspberry Pi camera board." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/blog/raspberry-pi-camera-board-video-streaming/" /><meta property="article:published_time" content="2013-09-25T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-09-25T00:00:00&#43;00:00"/>

<meta itemprop="name" content="Raspberry Pi camera board video streaming">
<meta itemprop="description" content="Set up a video streaming server using the Raspberry Pi camera board.">


<meta itemprop="datePublished" content="2013-09-25T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2013-09-25T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="961">



<meta itemprop="keywords" content="Raspberry Pi,Raspbian,video,streaming,mjpg-streamer," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Raspberry Pi camera board video streaming"/>
<meta name="twitter:description" content="Set up a video streaming server using the Raspberry Pi camera board."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://example.org/" class="f3 fw2 hover-white no-underline white-90 dib">
      My New Hugo Site
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        BLOGS
      </p>
      <h1 class="f1 athelas mb1">Raspberry Pi camera board video streaming</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2013-09-25T00:00:00Z">September 25, 2013</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<figure>
  <a href="{{ .Site.BaseURL }}/raspberry-pi-camera-board-high-res.jpg" target="_blank"><img src="{{ .Site.BaseURL }}/raspberry-pi-camera-board-640x480.jpg" alt=""></a>
    <figcaption>
    Raspberry Pi camera board
    </figcaption>
</figure>

<p>So you got your <a href="http://www.raspberrypi.org/">Raspberry Pi</a> and decided to get a <a href="http://downloads.element14.com/raspberry-pi-camera/">Camera Board</a> to do something awesome with it. Why not turn it a simple video streamer? That&rsquo;s what I thought too. I wanted to set up a simple security camera for my home so that I can see spy on whoever is lurking around from wherever I am through a web browser. Turns out it wasn&rsquo;t hard at all to set up. This <a href="http://blog.miguelgrinberg.com/post/stream-video-from-the-raspberry-pi-camera-to-web-browsers-even-on-ios-and-android">blog post</a> helped me get started. I&rsquo;m going to walk you through all the steps I took.</p>

<h2 id="installing-raspbian">Installing Raspbian</h2>

<p>I want to point out that I am using the Debian based <a href="http://www.raspbian.org/">Raspbian</a> operating system. I followed this <a href="http://elinux.org/RPi_Easy_SD_Card_Setup">article</a> on how to make the bootable SD card. Basically all I did was download the <a href="http://www.raspberrypi.org/downloads">Raspbian img</a>, unmount the SD card, and ran the <code>dd</code> command (on Ubuntu).</p>

<pre><code class="language-bash"># List the mounted media devices.
df -h

# Unmount SD card to be able to write the img on to it.
# Important that you make sure you are unmounting the correct device.
umount /dev/sdd1

# Now write the img file.
# Adjust the input file path to your own.
# VERY IMPORTANT that the output path is pointing to your SD card.
# If not set correctly it can possibly corrupt your hard drive.
sudo dd bs=4M if=~/Downloads/2013-05-25-wheezy-raspbian.img of=/dev/sdd

# Be patient. It might take a minute or two to copy the Raspbian img on the SD card.
</code></pre>

<h2 id="installing-mjpg-streamer">Installing MJPG Streamer</h2>

<p>After booting up your Raspberry Pi, install <a href="https://code.google.com/p/mjpg-streamer/">MJPG Streamer</a>.</p>

<pre><code class="language-bash"># Make and change into directory.
sudo mkdir /opt/mjpg-streamer
cd /opt/mjpg-streamer/

# Install the following packages.
sudo apt-get install libjpeg8-dev
sudo apt-get install imagemagick
sudo apt-get install subversion

# Download MJPG Streamer into the current directory.
sudo svn co https://svn.code.sf.net/p/mjpg-streamer/code/mjpg-streamer/ .

# Run make.
sudo make
</code></pre>

<p>If you get the following error:</p>

<pre><code class="language-bash">linux/videodev.h: No such file or directory
</code></pre>

<p>Make sure you have <code>libv4l-dev</code> installed and create a symbolic link for the header file:</p>

<pre><code class="language-bash">sudo apt-get install libv4l-dev
sudo ln -s /usr/include/libv4l1-videodev.h /usr/include/linux/videodev.h
</code></pre>

<h2 id="start-capturing">Start capturing</h2>

<p>Alright now for the fun part. Streaming the video.</p>

<pre><code class="language-bash"># Make a directory to store the temporary images.
sudo mkdir /tmp/stream/
# Make the directory writable.
sudo chmod a+rw /tmp/stream/


# Start capturing.
# See what the raspistill options are.
raspistill --help
# You see the record light turn on after executing the following line.
raspistill -w 640 -h 480 -q 5 -o /tmp/stream/pic.jpg -tl 100 -t 9999999 -th 0:0:0 -n &amp;

# See what the MJPG Streamer options are.
/opt/mjpg-streamer/mjpg_streamer --help
# Run the following to start up the MJPG Streamer streaming webserver.
LD_LIBRARY_PATH=/opt/mjpg-streamer/ /opt/mjpg-streamer/mjpg_streamer -i &quot;input_file.so -f /tmp/stream -n pic.jpg&quot; -o &quot;output_http.so -p 9000 -w /opt/mjpg-streamer/www&quot; &amp;
</code></pre>

<p>If everything went smoothly you can open up a web browser and go to:</p>

<pre><code class="language-bash">http://&lt;your-raspberry-pi-ip-address&gt;:9000/
</code></pre>

<figure>
  <a href="{{ .Site.BaseURL }}/mjpg-streamer-demo-pages-high-res.png" target="_blank"><img src="{{ .Site.BaseURL }}/mjpg-streamer-demo-pages-640.png" alt=""></a>
    <figcaption>
    MJPG Streamer streaming webserver.
    </figcaption>
</figure>

<p>There you have it. To access your streaming webserver remotely you will need to enable port forwarding on your router. Since every router is different I can&rsquo;t explain how, but the <a href="http://portforward.com/english/routers/port_forwarding/">PortForward</a> site can guide you.</p>

<h2 id="stopping-stream">Stopping stream</h2>

<p>To stop capturing and turn of the webserver we must kill the <code>raspistill</code> and <code>mjpg</code> processes that are running in the background.</p>

<pre><code class="language-bash"># Find the proccess id of `raspistill` and kill it.
pgrep raspistill
kill &lt;process id&gt;

# Find the proccess id of `mjpg` and kill it.
pgrep mjpg
kill &lt;process id&gt;
</code></pre>

<h2 id="bash-scripts">Bash scripts</h2>

<p>Here&rsquo;s a <code>start_steam.sh</code> and <code>stop_stream.sh</code> bash script to make it a bit easier (<a href="https://gist.github.com/miguelmota/8203904">gist</a>):</p>

<p><code>start_stream.sh</code>:</p>

<pre><code class="language-bash">#!/bin/bash

if [ ! -d /tmp/stream ]
then
    mkdir /tmp/stream/
fi

if pgrep raspistill &gt; /dev/null
then
    echo &quot;raspistill already running&quot;
else
    raspistill -w 640 -h 480 -q 5 -o /tmp/stream/pic.jpg -tl 100 -t 9999999 -th 0:0:0 -n &gt; /dev/null 2&gt;&amp;1&amp;
    echo &quot;raspistill started&quot;
fi

if pgrep mjpg_streamer &gt; /dev/null
then
    echo &quot;mjpg_streamer already running&quot;
else
    LD_LIBRARY_PATH=/opt/mjpg-streamer/ /opt/mjpg-streamer/mjpg_streamer -i &quot;input_file.so -f /tmp/stream -n pic.jpg&quot; -o &quot;output_http.so -p 9000 -w /opt/mjpg-streamer/www&quot; &gt; /dev/null 2&gt;&amp;1&amp;
    echo &quot;mjpg_streamer started&quot;
fi
</code></pre>

<p><code>stop_stream.sh</code></p>

<pre><code class="language-bash">#!/bin/bash

if pgrep raspistill
then
    kill $(pgrep raspistill) &gt; /dev/null 2&gt;&amp;1
    echo &quot;raspistill stopped&quot;
else
    echo &quot;raspistill not running&quot;
fi

if pgrep mjpg_streamer
then
    kill $(pgrep mjpg_streamer) &gt; /dev/null 2&gt;&amp;1
    echo &quot;mjpg_streamer stopped&quot;
else
    echo &quot;mjpg_streamer not running&quot;
fi
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>The possibilities are endless on the things you can do with a Raspberry Pi. I hope this tutorial helped you get started with simple video streaming on the Raspberry Pi using the awesome camera board module. Leave a comment if this post was useful or not. There is always room for improvement.</p>

<h2 id="update-19-jan-2014-easier-way-to-stream">Update: 19 Jan 2014 - Easier way to stream</h2>

<p>I stumbled upon this <a href="https://github.com/jacksonliam/mjpg-streamer">fork of MJPG Streamer on github</a> which comes with the raspicam input plugin. Using this version of MJPG Streamer we can skip dealing with raspistill and let the raspicam plugin take care of creating the images. Here&rsquo;s how to install it.</p>

<pre><code class="language-bash"># Install dev version of libjpeg
sudo apt-get install libjpeg62-dev

# Install cmake
sudo apt-get install cmake

# Download mjpg-streamer with raspicam plugin
git clone https://github.com/jacksonliam/mjpg-streamer.git ~/mjpg-streamer

# Change directory
cd ~/mjpg-streamer/mjpg-streamer-experimental

# Compile
make clean all

# Replace old mjpg-streamer
sudo rm -rf /opt/mjpg-streamer
sudo mv ~/mjpg-streamer/mjpg-streamer-experimental /opt/mjpg-streamer
sudo rm -rf ~/mjpg-streamer

# Begin streaming
LD_LIBRARY_PATH=/opt/mjpg-streamer/ /opt/mjpg-streamer/mjpg_streamer -i &quot;input_raspicam.so -fps 15 -q 50 -x 640 -y 480&quot; -o &quot;output_http.so -p 9000 -w /opt/mjpg-streamer/www&quot; &amp;
</code></pre>

<p>Updated start/stop bash scripts (<a href="https://gist.github.com/miguelmota/9201942">gist</a>).</p>

<p><code>start_steam.sh</code>:</p>

<pre><code class="language-bash">#!/bin/bash

if pgrep mjpg_streamer &gt; /dev/null
then
  echo &quot;mjpg_streamer already running&quot;
else
  LD_LIBRARY_PATH=/opt/mjpg-streamer/ /opt/mjpg-streamer/mjpg_streamer -i &quot;input_raspicam.so -fps 15 -q 50 -x 640 -y 480&quot; -o &quot;output_http.so -p 9000 -w /opt/mjpg-streamer/www&quot; &gt; /dev/null 2&gt;&amp;1&amp;
  echo &quot;mjpg_streamer started&quot;
fi
</code></pre>

<p><code>stop_stream.sh</code>:</p>

<pre><code class="language-bash">#!/bin/bash

if pgrep mjpg_streamer
then
  kill $(pgrep mjpg_streamer) &gt; /dev/null 2&gt;&amp;1
  echo &quot;mjpg_streamer stopped&quot;
else
  echo &quot;mjpg_streamer not running&quot;
fi
</code></pre>

<p>I found this solution to work much more smoother than what I previously posted. Here&rsquo;s a <a href="https://vine.co/v/MubLqUx3j3A">short Vine video</a> showing it in action.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/raspberry-pi" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Raspberry Pi</a>
   </li>
  
   <li class="list">
     <a href="/tags/raspbian" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Raspbian</a>
   </li>
  
   <li class="list">
     <a href="/tags/video" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">video</a>
   </li>
  
   <li class="list">
     <a href="/tags/streaming" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">streaming</a>
   </li>
  
   <li class="list">
     <a href="/tags/mjpg-streamer" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">mjpg-streamer</a>
   </li>
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/set-up-raspberry-pi-as-a-network-server/">Set up Raspberry Pi as a Network Server</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/responsive-video/">Responsive Video</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy; 2019 My New Hugo Site
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
